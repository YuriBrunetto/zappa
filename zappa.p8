pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
	gravity=100
	dt=1/60
	player={
		w=4,
		h=8,
		x=8,
		y=8,
		dir=0,
		acc=20,
		fric=10,
		onair=false,
		flipped=false
	}
end

function _update60()
	_input()
	
	-- up and down
	local dy=gravity*dt
	if dy > 0 then
	 if collide(player,"down") then
	  dy = 0
	 end
	end
	if dy < 0 then
	 if collide(player,"up") then
	  dy = 0
	 end
	end
	
	if dy != 0 then
		player.onair=true
	else
		player.onair=false
	end
		
	-- left and right
	local dx = player.dir * player.acc
	if dx > 0 then
	 if collide(player,"right") then
	  dx = 0
	 end
	end
	if dx < 0 then
	 if collide(player,"left") then
	  dx = 0
	 end
	end
	
	-- final position update
	-- player.x+=dx
	player.y+=dy
		
end

function _draw()
	cls(1)
	map(0,0)
	spr(player_spr(),player.x,
	                 player.y)
end

function _input()
	if btn(0) then
		player.dir = -1
	end
	if btn(1) then
		player.dir = 1
	end
	if not (btn(0) and btn(1)) then
		player.dir = 0
	end
	if btn(2)
	and not player.onair then
	 gravity = -100
	 player.flipped = true
	end
	if btn(3)
 and not player.onair then
  gravity = 100
  player.flipped = false
 end
end

function player_spr()
	if player.flipped then
		return 3
	else
		return 2
	end
end
-->8
--collision
function collide(pl,aim)
	local x=pl.x local y=pl.y
	local w=pl.w local h=pl.h

	local x1=0 local y1=0
	local x2=0 local y2=0
	
	if aim=="left" then
   x1=x-1  y1=y
   x2=x    y2=y+h-1
 elseif aim=="right" then
   x1=x+w-1    y1=y
   x2=x+w  y2=y+h-1
 elseif aim=="up" then
   x1=x+2    y1=y-1
   x2=x+w-3  y2=y
 elseif aim=="down" then
   x1=x+2      y1=y+h
   x2=x+w-3    y2=y+h
 end

 --pixels to tiles
 x1/=8    y1/=8
 x2/=8    y2/=8
	
	if fget(mget(x1,y1),0)
	or fget(mget(x1,y2),0)
	or fget(mget(x2,y1),0)
	or fget(mget(x2,y2),0) then
  return true
	else
  return false
	end
end
__gfx__
00000000555555550000000000800800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000565566550000000000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700566555650000000000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770005565556500000000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700055565555000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700555555550008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000556665650008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555550080080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000170501d0501e05017050170501a050170501c05017050170501805017050170501a050170501c050170501d0501e05017050170501a050170501e050170501d0501c05017050170501a050170501c050
